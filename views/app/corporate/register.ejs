<% include ./partials/header %>


    <body
        class="vertical-layout vertical-menu-modern 1-column  navbar-floating footer-static bg-full-screen-image  blank-page blank-page"
        data-open="click" data-menu="vertical-menu-modern" data-col="1-column">
        <!-- BEGIN: Content-->
        <div class="app-content content">
            <div class="content-overlay"></div>
            <div class="header-navbar-shadow"></div>
            <div class="content-wrapper">
                <div class="content-header row">
                </div>
                <div class="content-body" id="login_card">
                    <section class="row flexbox-container">
                        <div class="col-xl-5 col-lg-5 col-md-6 col-sm-10 col-12 d-flex justify-content-center 
                        rounded  py-0 px-xl-0 px-lg-0 px-md-0 px-sm-3 px-0">
                            <div class="col-xl-12 card bg-authentication rounded mb-0 Regular shadow px-0">
                                <div class="row m-0">
                                    <div class="col-12 text-center align-self-center px-1 py-0 logo_sec my-1">
                                        <img src="/images/logo/logo.png" alt="branding logo"
                                            class="img-fluid  brand_logo brand-custom">
                                    </div>
                                    <div class=" col-12 p-0">
                                        <div class="card rounded-0 mb-0 px-xl-2 px-lg-2 px-md-2 px-sm-0 px-0 card-placement-bottom">
                                            <div class="card-header pb-1 center-belong">
                                                <div class="card-title text-center">
                                                    <h4>Company Portal</h4>
                                                </div>
                                            </div>
                                            <p class="card-header pt-0 center-belong">Please signup for a new account.</p>
                                            <div class="card-content px-0">
                                                <div class="card-body">
                                                    <ul class="nav nav-tabs justify-content-left" role="tablist">
                                                        <li class="nav-item">
                                                            <a class="nav-link" id="service-tab-center"
                                                                data-toggle="tab" href="/company/login"
                                                                aria-controls="service-center" role="tab"
                                                                aria-selected="false">Login</a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a class="nav-link active" id="home-tab-center"
                                                                data-toggle="tab" href="/company/register"
                                                                aria-controls="home-center" role="tab"
                                                                aria-selected="true">Signup</a>
                                                        </li>
                                                    </ul>
                                                    <div class="tab-content">
                                                        <div class="tab-pane" id="service-center"
                                                            aria-labelledby="service-tab-center" role="tabpanel">
                                                            <div class="card rounded-0 mb-0">
                                                                <div class="card-content">
                                                                    <div class="card-body p-0">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="tab-pane active" id="home-center"
                                                            aria-labelledby="home-tab-center" role="tabpanel">
                                                            <div class="card rounded-0 mb-0">
                                                                <div class="card-content">
                                                                    <div class="card-body p-0">
                                                                        <form>
                                                                            <div class="row">

                                                                           
                                                                            <fieldset
                                                                                class=" col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 form-label-group form-group position-relative has-icon-left ">
                                                                                <input type="text" class="form-control"
                                                                                    id="first-name"
                                                                                    placeholder="First Name" value=""
                                                                                    maxlength="15"
                                                                                    onkeypress="return alphaOnly(event)"
                                                                                    required>
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-user"></i>
                                                                                </div>
                                                                            </fieldset>
                                                                            <fieldset
                                                                                class="  col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 form-label-group form-group position-relative has-icon-left ">
                                                                                <input type="text" class="form-control"
                                                                                    id="last-name"
                                                                                    placeholder="Last Name" value=""
                                                                                    onkeypress="return alphaOnly(event)"
                                                                                    maxlength="15" required>
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-user"></i>
                                                                                </div>
                                                                            </fieldset>

                                                                            <fieldset
                                                                                class="  col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 form-label-group form-group position-relative has-icon-left col-6">
                                                                                <input type="email" class="form-control"
                                                                                    id="user-mail"
                                                                                    placeholder="Email ID" value=""
                                                                                    maxlength="30" required>
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-mail"></i>
                                                                                </div>
                                                                            </fieldset>
                                                                            <fieldset
                                                                                class="  col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 form-label-group position-relative has-icon-left">
                                                                                <input type="text" class="form-control"
                                                                                    name="comanyname" id="company-name"
                                                                                    placeholder="Company Name" value=""
                                                                                    maxlength="50" required>
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-user"></i>
                                                                            </fieldset>
                                                                            <fieldset
                                                                                class="  col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 input-group form-label-group form-group position-relative has-icon-left">
                                                                                <input type="tel" class="form-control"
                                                                                    maxlength="10" id="user-number"
                                                                                    pattern="[0-9]{10}" value=""
                                                                                    placeholder="Mobile"
                                                                                    aria-label="Mobile Number"
                                                                                    aria-describedby="basic-addon2">
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-phone"></i>
                                                                                </div>
                                                                                <div class="input-group-append">
                                                                                    <button
                                                                                        class="btn btn-primary float-right btn-inline waves-effect waves-light text-white"
                                                                                        type="button"
                                                                                        id="generate-otp">Send
                                                                                        OTP <span
                                                                                            class="d-xl-inline d-lg-inline d-md-inline d-sm-none d-none"></span></button>
                                                                                </div>
                                                                            </fieldset>
                                                                            <fieldset
                                                                                class="  col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 form-label-group position-relative has-icon-left">
                                                                                <input type="number"
                                                                                    class="form-control" id="user-otp"
                                                                                    placeholder="Enter your OTP"
                                                                                    value="" disabled>
                                                                                <div class="form-control-position">
                                                                                    <i class="feather icon-lock"></i>
                                                                                </div>
                                                                                <label for="user-otp">Enter the
                                                                                    OTP</label>
                                                                            </fieldset>
                                                                            <p class="pt-0 px-1">I agree to <a
                                                                                    href="/employersTermsofService"
                                                                                    target="_blank">Employers terms of
                                                                                    use</a> and <a
                                                                                    href="/userAgreement"
                                                                                    target="_blank">User Agreement</a>.
                                                                            </p>
                                                                            <div class="row">
                                                                                <div
                                                                                    class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                                                                    <a class="btn btn-primary btn-block waves-effect waves-light text-white"
                                                                                        id="submit-button">Signup</a>
                                                                                </div>
                                                                                <div
                                                                                    class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                                                                    <div class="btn btn-primary btn-block waves-effect waves-light text-white"
                                                                                        id="resend-btn"
                                                                                        style="padding: 1rem;">Resend
                                                                                        OTP
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        </form>
                                                                        <div id="error"
                                                                            style="color:red;font-weight: bold; display:none;">
                                                                        </div>
                                                                        <div id="success"
                                                                            style="color:green;font-weight: bold; display:none;">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </section>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.0/axios.min.js"
            integrity="sha512-OdkysyYNjK4CZHgB+dkw9xQp66hZ9TLqmS2vXaBrftfyJeduVhyy1cOfoxiKdi4/bfgpco6REu6Rb+V2oVIRWg=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script type="text/javascript">
            const firstName = document.getElementById('first-name');
            const lastName = document.getElementById('last-name')
            const userMail = document.getElementById('user-mail');
            const phoneNumber = document.getElementById('user-number');
            // const companyEmail = document.getElementById('company-email');
            const userNumber = document.getElementById('user-number');
            const corporateName = document.getElementById('company-name');
            const generateOTP = document.getElementById('generate-otp');
            const resendBtn = document.getElementById('resend-btn');
            const signupBtn = document.getElementById('submit-button');
            const otpField = document.getElementById("user-otp");
            $(resendBtn).hide();
            $(signupBtn).hide();
            const checkEmail = (email) => {
                let emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/
                return emailReg.test(email);
            }
            userNumber.addEventListener('keypress', (e) => {
                let k = e.which;
                if (k > 58 || k < 48)
                    e.preventDefault();
            })
            resendBtn.addEventListener('click', (event) => {
                event.preventDefault();
                const body = { mobile: phoneNumber.value }
                $.get("/api/resendOTP", body).then((res) => {
                    if (res.status === true) {
                        $('#error').text(' ')
                        $('#error').hide()
                        // $('#success').show();
                        // $('#success').text("OTP resent");
                        $('#resend-btn').addClass('disabled');
                        let time = 20000;
                        let interval = setInterval(function () {
                            time = time - 1000; //reduce each second
                            let timeleft = (time / 1000) % 60
                            $('#resend-btn').text(`Resend in ${timeleft} secs`)
                            if (time <= 0) {
                                $('#resend-btn').text('Resend OTP');
                                clearInterval(interval)
                                $('#resend-btn').removeClass('disabled')
                            }
                        }, 1000);
                    } else {
                        $('#error').text(res.data.message);
                        $('#error').show()
                        $('#success').text(' ');
                        $('#success').hide();
                    }
                })
            })

            phoneNumber.addEventListener('input', (event) => {
                if (event.target.value.length === 10 || event.target.value.length === 12) {
                    let pattern = /[0-9]{10,12}/gm;
                    let test = pattern.test(event.target.value);
                    const body = { mobile: event.target.value }
                    if (test === true) {
                        $('#error').text(" ");
                        $('#error').hide();
                        generateOTP.addEventListener('click', (event) => {
                            event.preventDefault();
                            axios.post("/api/sendOtptoRegisterCompany", body).then((res) => {
                                if (res.data.status === true) {
                                    $('#error').hide()
                                    $('#success').show();
                                    $('#success').text("OTP sent successfully");
                                    otpField.disabled = false;
                                    $(generateOTP).hide();
                                    $(signupBtn).show();
                                    $(resendBtn).show();
                                    $('#resend-btn').addClass('disabled')
                                    let time = 20000;
                                    let interval = setInterval(function () {
                                        time = time - 1000; //reduce each second
                                        let timeleft = (time / 1000) % 60
                                        $('#resend-btn').text(`Resend in ${timeleft} secs`)
                                        if (time <= 0) {
                                            $('#resend-btn').text('Resend OTP');
                                            clearInterval(interval)
                                            $('#resend-btn').removeClass('disabled')
                                        }
                                    }, 1000);
                                } else {
                                    $('#error').text(res.data.message);
                                    $('#error').show()
                                    $('#success').hide();
                                }
                            })
                        })
                    } else {
                        $('#success').text(" ");
                        $('#success').hide();
                        $('#error').show();
                        $('#error').text("Enter a valid mobile number");
                        otpField.disabled = true
                    }
                }
                else {
                    $('#success').text(" ");
                    $('#success').hide();
                    $('#error').show();
                    $('#error').text("Enter a valid mobile number");
                    otpField.disabled = true
                }
            })
            otpField.addEventListener('input', (event) => {
                if (event.target.value.length === 4) {
                    $('#error').text(' ');
                    $('#error').hide();
                } else {
                    $('#success').text(' ');
                    $('#success').hide()
                    $('#error').show();
                    $('#error').text("Incorrect OTP");
                }
            })

            signupBtn.addEventListener('click', () => {
                if (userMail.value.length && !checkEmail(userMail.value)) {
                    $('#error').show()
                    $('#error').text('Not a Valid Email!')
                }
                else if (firstName.value.trim().length !== 0 && lastName.value.trim().length !== 0 && phoneNumber.value.length !== 0 && otpField.value.length !== 0 && corporateName.value.trim() !== '') {
                    let body;
                    body = { mobile: phoneNumber.value, otp: otpField.value }
                    axios.post('/api/verifyOtp', body).then((res) => {
                        if (res.data.status === true) {
                            $('#error').text(' ');
                            $('#error').hide();
                            $('#success').show();
                            $('#success').text("OTP verified");
                            body = { firstName: firstName.value, lastName: lastName.value, email: userMail.value.trim(), phoneNumber: userNumber.value, companyName: corporateName.value };
                            axios.post("/company/register", body).then((res) => {
                                if (res.data.status === 'success') {
                                    body = { mobile: phoneNumber.value }
                                    axios.post("/api/otpCompanyLogin", body).then((res) => {
                                        if (res.data.status === true) {
                                            localStorage.setItem("company", res.data.name);
                                            localStorage.setItem("registeredEmail", res.data.email);
                                            localStorage.setItem("token", res.data.token);
                                            window.location.href = "/company/dashboard";
                                        } else {
                                            $('#success').text(" ");
                                            $('#success').hide();
                                            $('#error').show();
                                            $('#error').text("Login failed !!!");
                                            window.location.href = "/company/login"
                                        }
                                    })
                                } else {
                                    $('#success').text(" ");
                                    $('#success').hide();
                                    $('#error').show();
                                    $('#error').text(res.data.error);
                                }
                            })
                        } else {
                            $('#success').text(' ');
                            $('#success').hide()
                            $('#error').show();
                            $('#error').text("Incorrect OTP");
                        }
                    })
                } else {
                    $('#success').text(" ");
                    $('#success').hide();
                    $('#error').show();
                    $('#error').text("Please fill all the fields !!!");
                }
            })

            function alphaOnly(e) {
                let k = e.which;
                if (k >= 65 && k <= 90) { return true }
                else if (k >= 97 && k <= 122) { return true }
                else if (k == 32) { return true }
                else { return false }
            }
            let input = document.getElementById("user-otp");
            input.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    document.getElementById("submit-button").click();
                }
            });
            phoneNumber.addEventListener('keypress', (e) => {
                if (e.key === "Enter" && e.target.value.length === 10) {
                    e.preventDefault();
                    generateOTP.click();
                    setTimeout(() => {
                        input.focus();
                    }, 600)
                }
            })
        </script>
    </body>

    </html>