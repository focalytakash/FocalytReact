<% include ./partials/header %>

    <body
        class="vertical-layout vertical-menu-modern 1-column  navbar-floating footer-static bg-full-screen-image  blank-page blank-page"
        data-open="click" data-menu="vertical-menu-modern" data-col="1-column">
        <!-- BEGIN: Content-->
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W39K27R"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
        <div class="app-content content">
            <div class="content-overlay"></div>
            <div class="header-navbar-shadow"></div>
            <div class="content-wrapper">
                <div class="content-header row">
                </div>
                <div class="content-body" id="login_card">
                    <section class="row flexbox-container">
                        <div class="col-xl-6 col-lg-7 col-sm-9 col-12 d-flex justify-content-center px-3">
                            <div class="col-xl-12 card bg-authentication rounded shadow mb-0 px-0">
                                <div class="row m-0">
                                    <div class="col-lg-12 text-center align-self-center px-1 py-0 logo_sec">
                                        <img src="/images/logo/logo.png" alt="branding logo "
                                            class="img-fluid brand_logo w-25 py-1">
                                    </div>
                                    <div class="col-lg-12 col-12 p-0">
                                        <div class="card rounded-0 mb-0 card-placement px-xl-2 px-lg-2 px-md-1  px-sm-0  px-0">
                                            <div class="card-header pb-1">
                                                <div class="card-title">
                                                    <h4>Company Portal</h4>
                                                </div>
                                            </div>
                                            <p class="card-header mb-0 pt-0">Please login to your account.</p>
                                            <div class="card-content">
                                                <div class="card-body">
                                                    <ul class="nav nav-tabs justify-content-left" role="tablist">
                                                        <li class="nav-item">
                                                            <a class="nav-link active" id="service-tab-center"
                                                                data-toggle="tab" href="/company/login"
                                                                aria-controls="service-center" role="tab"
                                                                aria-selected="false">Login</a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a class="nav-link" id="home-tab-center" data-toggle="tab"
                                                                href="/company/register" aria-controls="home-center"
                                                                role="tab" aria-selected="true">Signup</a>
                                                        </li>
                                                    </ul>
                                                    <div class="tab-content mt-2">
                                                        <div class="tab-pane active" id="service-center"
                                                            aria-labelledby="service-tab-center" role="tabpanel">
                                                            <div class="card rounded-0 mb-0">
                                                                <div class="card-content">
                                                                    <div class="card-body p-0 mt-1">
                                                                        <fieldset
                                                                            class="input-group form-label-group form-group position-relative has-icon-left">
                                                                            <input type="tel" class="form-control"
                                                                                maxlength="10" id="user-input"
                                                                                placeholder="Mobile" pattern="[0-9]{10}"
                                                                                value="" aria-label="Mobile Number"
                                                                                aria-describedby="basic-addon2">
                                                                            <div class="form-control-position">
                                                                                <i class="feather icon-phone"></i>
                                                                            </div>
                                                                            <div class="input-group-append">
                                                                                <button
                                                                                    class="btn btn-primary float-right btn-inline waves-effect waves-light text-white"
                                                                                    type="button" id="generate-otp">Send
                                                                                    OTP<span
                                                                                        class="d-xl-inline d-lg-inline d-md-inline d-sm-none d-none"></span></button>
                                                                            </div>
                                                                        </fieldset>

                                                                        <fieldset
                                                                            class="form-label-group position-relative has-icon-left"
                                                                            id="user-otp">
                                                                            <input type="number" class="form-control"
                                                                                id="otp-input" placeholder="Enter OTP"
                                                                                value="">
                                                                            <div class="form-control-position">
                                                                                <i class="feather icon-send"></i>
                                                                            </div>
                                                                            <label for="Enter OTP">Enter
                                                                                OTP</label>
                                                                        </fieldset>
                                                                        <p class="pt-0 px-0">Please <a href="tel:+918699081947">Contact Us</a> for a change of Mobile Number. </p>
                                                                        <p class="pt-0 px-0">I agree to <a
                                                                                href="/employersTermsofService"
                                                                                target="_blank">Employers terms of
                                                                                use</a> and <a
                                                                                href="/userAgreement"
                                                                                target="_blank">User Agreement</a>.</p>
                                                                        <div class="row">
                                                                            <div
                                                                                class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                                                                <a class="btn btn-primary float-right btn-inline waves-effect waves-light text-white btn-block"
                                                                                    id="verify-login-btn">
                                                                                    Login</a>
                                                                            </div>
                                                                            <div
                                                                                class="colx-l-6 col-lg-6 col-md-6 col-sm-6 col-6">
                                                                                <div class="btn btn-primary btn-block waves-effect waves-light text-white btn-block"
                                                                                    id="resend-btn"
                                                                                    style="padding: 1rem;">Resend
                                                                                    OTP</div>
                                                                            </div>
                                                                        </div>
                                                                        <div id="error"
                                                                            style="color:red;font-weight: bold; display:none;">
                                                                        </div>
                                                                        <div id="success"
                                                                            style="color:green;font-weight: bold; display:none;">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="tab-pane " id="home-center"
                                                            aria-labelledby="home-tab-center" role="tabpanel">
                                                            <div class="card rounded-0 mb-0">
                                                                <div class="card-content">
                                                                    <div class="card-body p-0">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </section>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            const userInput = document.getElementById("user-input");
            const generateOTP = document.getElementById('generate-otp');
            const otpField = document.getElementById("user-otp");
            const resendBtn = document.getElementById("resend-btn");
            loginBtn = document.getElementById('verify-login-btn')
            userInput.addEventListener("keypress", (e) => {
                let k = e.which;
                if (k > 58 || k < 48)
                    e.preventDefault();
            })
            $(loginBtn).hide();
            $(resendBtn).hide();
            resendBtn.addEventListener('click', (event) => {
                if ($(resendBtn).hasClass('disabled')) {
                    return false
                }
                event.preventDefault();
                const body = { mobile: userInput.value }
                $.get("/api/resendOTP", body).then((res) => {
                    if (res.status === true) {
                        $('#error').text(' ')
                        $('#error').hide()
                        $('#success').show();
                        $('#success').text("OTP resend");
                        $('#resend-btn').addClass('disabled');
                        let time = 20000;
                        let interval = setInterval(function () {
                            time = time - 1000; //reduce each second
                            let timeleft = (time / 1000) % 60
                            $('#resend-btn').text(`Resend in ${timeleft} secs`)
                            if (time <= 0) {
                                $('#resend-btn').text('Resent OTP');
                                clearInterval(interval)
                                $('#resend-btn').removeClass('disabled')
                            }
                        }, 1000);
                    } else {
                        $('#error').text(res.data.message);
                        $('#error').show()
                        $('#success').text(' ');
                        $('#success').hide();
                    }
                })
            })
            $(loginBtn).hide();
            $(otpField).hide()
            generateOTP.addEventListener('click', (event) => {
                event.preventDefault();
                if (userInput.value.length !== 10) {
                    $('#success').text(" ");
                    $('#success').hide();
                    $('#error').show();
                    $('#error').text("Please enter the correct mobile number");
                } else {
                    const body = { mobile: userInput.value }
                    axios.post("/api/sendCompanyOtp", body).then((res) => {
                        if (res.data.status === true) {
                            $('#error').text(" ");
                            $('#error').hide()
                            $('#success').show();
                            $('#success').text("OTP sent successfully");
                            $(otpField).show();
                            $(generateOTP).hide();
                            $(loginBtn).show();
                            $(resendBtn).show();
                            $('#resend-btn').addClass('disabled')
                            let time = 20000;
                            let interval = setInterval(function () {
                                time = time - 1000; //reduce each second
                                let timeleft = (time / 1000) % 60
                                $('#resend-btn').text(`Resend in ${timeleft} secs`)
                                if (time <= 0) {
                                    $('#resend-btn').text('Resend OTP');
                                    clearInterval(interval)
                                    $('#resend-btn').removeClass('disabled')
                                }
                            }, 1000);
                        } else {
                            $('#error').text(res.data.message);
                            $('#error').show()
                        }
                    })
                }
            })
            otpField.addEventListener('input', (event) => {
                if (event.target.value.length === 4) {
                    $(loginBtn).show();
                    const otp = event.target.value
                    let body;
                    body = {
                        mobile: userInput.value,
                        otp
                    }
                    loginBtn.addEventListener('click', () => {
                        axios.post('/api/verifyOtp', body).then((res) => {
                            if (res.data.status === true) {
                                $('#error').text(" ");
                                $('#error').hide()
                                $('#success').show();
                                $('#success').text("OTP verified");
                                axios.post("/api/otpCompanyLogin", body).then((res) => {
                                    if (res.data.status === true) {
                                        localStorage.setItem("company", res.data.name);
                                        localStorage.setItem("registeredEmail", res.data.email);
                                        localStorage.setItem("token", res.data.token);
                                        window.location.href = "/company/dashboard";
                                    } else {
                                        $('#success').text(" ");
                                        $('#success').hide();
                                        $('#error').show();
                                        $('#error').text("Login failed !!!");
                                    }
                                })
                            } else {
                                $('#success').text(" ");
                                $('#success').hide();
                                $('#error').show();
                                $('#error').text("Incorrect OTP");
                            }
                        })
                    })
                }
            })
            // const userEmail = document.getElementById('user-email');
            // const userPassword = document.getElementById('user-password');
            // document.getElementById('login-btn').addEventListener('click', () => {
            //     if (userEmail.value !== '' && userPassword.value !== '') {
            //         const body = { email: userEmail.value, password: userPassword.value }
            //         $.post("/api/loginCommon", body).then((res) => {
            //             if (res.status) {
            //                 localStorage.setItem("company", res.data.user.name);
            //                 localStorage.setItem("registeredEmail", res.data.user.email);
            //                 localStorage.setItem("token", res.data.token);
            //                 window.location.href = "/company/dashboard";
            //             } else {
            //                 $('#error').show();
            //                 $('#error').text("Login failed !!!");
            //             }
            //         })
            //     } else {
            //         $('#error').show();
            //         $('#error').text("Please fill all the fields !!!");
            //     }
            // })
            let input = document.getElementById("otp-input");
            input.addEventListener("keypress", function (event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    document.getElementById("verify-login-btn").click();
                }
            });
            userInput.addEventListener("keypress", (e) => {
                if (e.key === "Enter" && e.target.value.length === 10) {
                    e.preventDefault();
                    generateOTP.click();
                    setTimeout(() => {
                        input.focus();
                    }, 600)
                }
            })
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </body>

    </html>